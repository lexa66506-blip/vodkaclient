<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - VodkaClient</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #1a0a2e 0%, #16082a 50%, #0d0515 100%);
    color: #fff;
    min-height: 100vh;
    overflow-x: hidden;
}

/* –ü–ª–∞–≤–∞—é—â–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
.floating-nav {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 12px 25px;
    background: rgba(15, 8, 25, 0.85);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(138, 43, 226, 0.25);
    border-radius: 50px;
}

.nav-logo {
    font-size: 18px;
    font-weight: 700;
    color: #a855f7;
    letter-spacing: 1px;
    margin-right: 15px;
}

.nav-links {
    display: flex;
    gap: 4px;
    align-items: center;
}

.nav-links a {
    color: rgba(255, 255, 255, 0.5);
    text-decoration: none;
    font-size: 13px;
    padding: 8px 14px;
    border-radius: 20px;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.nav-links a:hover {
    color: #fff;
    background: rgba(138, 43, 226, 0.2);
}

.nav-user {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    margin-left: 15px;
    cursor: pointer;
}

/* –õ—É—á–∏ —ç—Ñ—Ñ–µ–∫—Ç - —Å–æ–ª–Ω–µ—á–Ω—ã–µ –ª—É—á–∏ */
.rays-container {
    position: fixed;
    top: -20%;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    height: 120%;
    z-index: 1;
    pointer-events: none;
    overflow: visible;
}

.ray {
    position: absolute;
    top: 0;
    left: 50%;
    width: 2px;
    height: 200%;
    background: linear-gradient(180deg, 
        rgba(168, 85, 247, 0.4) 0%, 
        rgba(138, 43, 226, 0.2) 30%, 
        rgba(138, 43, 226, 0.05) 60%,
        transparent 100%);
    transform-origin: 50% 0%;
    filter: blur(2px);
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.main-container {
    position: relative;
    z-index: 10;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 100px 30px 30px;
}

.cabinet-wrapper {
    display: flex;
    gap: 20px;
    max-width: 1100px;
    width: 100%;
}

/* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
.left-panel {
    width: 420px;
    background: rgba(20, 10, 30, 0.85);
    border: 1px solid rgba(138, 43, 226, 0.25);
    border-radius: 20px;
    overflow: hidden;
    backdrop-filter: blur(15px);
}

.balls-container {
    position: relative;
    height: 260px;
    background: linear-gradient(180deg, rgba(25, 12, 40, 0.95) 0%, rgba(15, 8, 25, 0.95) 100%);
    overflow: hidden;
}

#ballsCanvas {
    width: 100%;
    height: 100%;
}

.balls-label {
    position: absolute;
    top: 12px;
    left: 15px;
    background: rgba(0, 0, 0, 0.6);
    padding: 5px 12px;
    border-radius: 6px;
    font-size: 11px;
    color: #666;
}

/* –ü—Ä–æ—Ñ–∏–ª—å */
.profile-section {
    padding: 25px;
}

.profile-info {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
}

.avatar {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: 3px solid rgba(138, 43, 226, 0.5);
    overflow: hidden;
}

.avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-details h2 {
    font-size: 20px;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.uid-badge {
    background: rgba(138, 43, 226, 0.3);
    padding: 3px 10px;
    border-radius: 5px;
    font-size: 11px;
    color: #a855f7;
}

.subscription-date {
    color: #777;
    font-size: 13px;
}

.subscription-date span {
    color: #a855f7;
}

/* –ö–Ω–æ–ø–∫–∞ Download - —Ç–µ–º–Ω–∞—è —Å –±–ª—é—Ä–æ–º */
.btn-download {
    width: 100%;
    padding: 14px;
    background: rgba(20, 10, 30, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(138, 43, 226, 0.2);
    border-radius: 10px;
    color: #888;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-download:hover {
    background: rgba(30, 15, 45, 0.8);
    border-color: rgba(138, 43, 226, 0.4);
}

.btn-download.active {
    background: rgba(40, 20, 60, 0.8);
    border: 1px solid rgba(138, 43, 226, 0.4);
    color: #a855f7;
}

/* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
.right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.right-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.info-panel {
    background: rgba(20, 10, 30, 0.85);
    border: 1px solid rgba(138, 43, 226, 0.25);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(15px);
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.info-row:last-child {
    border-bottom: none;
}

.info-label {
    color: #777;
    font-size: 14px;
}

.info-value {
    background: rgba(25, 15, 35, 0.9);
    padding: 8px 15px;
    border-radius: 8px;
    font-size: 13px;
    color: #ddd;
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.info-value.status {
    background: rgba(138, 43, 226, 0.2);
    color: #a855f7;
}

.info-value.hwid {
    font-family: monospace;
    font-size: 11px;
    color: #888;
}

/* Actions */
.actions-panel {
    background: rgba(20, 10, 30, 0.85);
    border: 1px solid rgba(138, 43, 226, 0.25);
    border-radius: 20px;
    padding: 25px;
    backdrop-filter: blur(15px);
}

.actions-title {
    font-size: 18px;
    margin-bottom: 20px;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.action-card {
    text-align: center;
}

.action-card label {
    display: block;
    font-size: 11px;
    color: #666;
    margin-bottom: 8px;
}

.action-btn {
    width: 100%;
    padding: 10px 12px;
    background: rgba(138, 43, 226, 0.15);
    border: 1px solid rgba(138, 43, 226, 0.3);
    border-radius: 8px;
    color: #a855f7;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s;
}

.action-btn:hover {
    background: rgba(138, 43, 226, 0.3);
    transform: translateY(-2px);
}

/* –¢–∞—Ä–∏—Ñ–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.tariff-card {
    background: rgba(138, 43, 226, 0.1);
    border: 1px solid rgba(138, 43, 226, 0.25);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.tariff-card:hover {
    background: rgba(138, 43, 226, 0.2);
    border-color: rgba(138, 43, 226, 0.5);
    transform: translateY(-3px);
}

.tariff-icon {
    font-size: 24px;
    margin-bottom: 8px;
}

.tariff-name {
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    margin-bottom: 5px;
}

.tariff-price {
    font-size: 18px;
    font-weight: 700;
    color: #a855f7;
}

/* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
.logout-btn {
    padding: 12px;
    background: rgba(255, 50, 50, 0.1);
    border: 1px solid rgba(255, 50, 50, 0.25);
    border-radius: 10px;
    color: #ff6b6b;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: auto;
}

.logout-btn:hover {
    background: rgba(255, 50, 50, 0.2);
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: rgba(20, 10, 30, 0.98);
    border: 1px solid rgba(138, 43, 226, 0.4);
    border-radius: 16px;
    padding: 30px;
    width: 400px;
    max-width: 90%;
}

.modal-title {
    font-size: 20px;
    margin-bottom: 20px;
    color: #fff;
}

.modal-input {
    width: 100%;
    padding: 12px 15px;
    background: rgba(10, 5, 15, 0.9);
    border: 1px solid rgba(138, 43, 226, 0.3);
    border-radius: 8px;
    color: #fff;
    font-size: 14px;
    margin-bottom: 15px;
}

.modal-input:focus {
    outline: none;
    border-color: #a855f7;
}

.modal-buttons {
    display: flex;
    gap: 10px;
}

.modal-btn {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.modal-btn.primary {
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    border: none;
    color: #fff;
}

.modal-btn.secondary {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #888;
}

.modal-message {
    margin-top: 10px;
    padding: 10px;
    border-radius: 6px;
    font-size: 13px;
    display: none;
}

.loading {
    text-align: center;
    padding: 100px 20px;
    font-size: 18px;
    color: #666;
}
</style>
</head>

<body>

<!-- –õ—É—á–∏ —ç—Ñ—Ñ–µ–∫—Ç -->
<div class="rays-container" id="raysContainer"></div>

<!-- –ü–ª–∞–≤–∞—é—â–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="floating-nav">
    <div class="nav-logo">VodkaClient</div>
    <div class="nav-links">
        <a href="/">üè† Home</a>
        <a href="https://t.me/SmertnixVteste" target="_blank" style="margin-left: -8px;">üí¨ Support</a>
    </div>
    <div class="nav-user" id="navUser">
        <span>üë§</span>
        <span id="navUsername">username</span>
    </div>
</nav>

<div class="main-container">
    <div id="loadingMessage" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div class="cabinet-wrapper" id="cabinetContent" style="display: none;">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="left-panel">
            <div class="balls-container">
                <canvas id="ballsCanvas"></canvas>
                <div class="balls-label">‚öô balls.tsx</div>
            </div>
            
            <div class="profile-section">
                <div class="profile-info">
                    <div class="avatar">
                        <img src="logo.png" alt="Avatar" id="avatarImg">
                    </div>
                    <div class="profile-details">
                        <h2>
                            <span id="usernameDisplay">username</span>
                            <span class="uid-badge">UID: <span id="uidDisplay">0</span></span>
                        </h2>
                        <div class="subscription-date">
                            Subscription: <span id="subscriptionDisplay">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn-download" id="downloadBtn">Download Loader</button>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="right-panel">
            <div class="info-panel">
                <div class="info-row">
                    <div class="info-label">üë§ Username:</div>
                    <div class="info-value" id="infoUsername">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">‚úâ E-Mail:</div>
                    <div class="info-value" id="infoEmail">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">‚è∞ Subscription:</div>
                    <div class="info-value" id="infoSubscription">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">üíª HWID:</div>
                    <div class="info-value hwid" id="infoHwid">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</div>
                </div>
                <div class="info-row">
                    <div class="info-label">‚ö° Role:</div>
                    <div class="info-value status" id="infoRole">User</div>
                </div>
                <div class="info-row">
                    <div class="info-label">‚≠ê Beta Access:</div>
                    <div class="info-value" id="infoBeta">–ù–µ—Ç</div>
                </div>
            </div>
            
            <div class="actions-panel">
                <div class="actions-title">Actions</div>
                <div class="actions-grid">
                    <div class="action-card">
                        <label>Configure RAM</label>
                        <button class="action-btn" onclick="openModal('ram')">Configure</button>
                    </div>
                    <div class="action-card">
                        <label>Activate Key</label>
                        <button class="action-btn" onclick="openModal('key')">Activate</button>
                    </div>
                    <div class="action-card">
                        <label>Change Avatar</label>
                        <button class="action-btn" onclick="openModal('avatar')">Change</button>
                    </div>
                </div>
                <button class="action-btn" onclick="openModal('password')" style="width: 100%; margin-top: 15px;">üîë –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </div>
            
            <!-- –¢–∞—Ä–∏—Ñ—ã -->
            <div class="actions-panel">
                <div class="actions-title">üíé –¢–∞—Ä–∏—Ñ—ã</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="tariff-card" onclick="window.open('https://t.me/SmertnixVteste', '_blank')">
                        <div class="tariff-icon">üìÖ</div>
                        <div class="tariff-name">1 –ù–µ–¥–µ–ª—è</div>
                        <div class="tariff-price">99‚ÇΩ</div>
                    </div>
                    <div class="tariff-card" onclick="window.open('https://t.me/SmertnixVteste', '_blank')">
                        <div class="tariff-icon">üîÑ</div>
                        <div class="tariff-name">–°–±—Ä–æ—Å HWID</div>
                        <div class="tariff-price">149‚ÇΩ</div>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 11px; margin-top: 12px;">–î–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ Support</p>
            </div>
            
            <button class="logout-btn" id="logoutBtn">üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div class="modal" id="keyModal">
    <div class="modal-content">
        <div class="modal-title">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–ª—é—á–∞</div>
        <input type="text" class="modal-input" id="keyInput" placeholder="VDK-XXXXXXXX-XXXXXXXX">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('key')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="activateKey()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div class="modal-message" id="keyMessage"></div>
    </div>
</div>

<div class="modal" id="passwordModal">
    <div class="modal-content">
        <div class="modal-title">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</div>
        <input type="password" class="modal-input" id="oldPassword" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
        <input type="password" class="modal-input" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('password')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å</button>
        </div>
        <div class="modal-message" id="passwordMessage"></div>
    </div>
</div>

<div class="modal" id="ramModal">
    <div class="modal-content">
        <div class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ RAM</div>
        <input type="number" class="modal-input" id="ramInput" placeholder="GB (2-16)" min="2" max="16" value="4">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('ram')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="saveRam()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<div class="modal" id="avatarModal">
    <div class="modal-content">
        <div class="modal-title">–°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</div>
        <p style="color: #666; margin-bottom: 15px;">–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('avatar')">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç–∞—è –∞–¥–º–∏–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Alt+N) -->
<div class="modal" id="adminModal">
    <div class="modal-content" style="border-color: rgba(255, 50, 50, 0.4);">
        <div class="modal-title" style="color: #ff6b6b;">üîê Admin Access</div>
        <input type="password" class="modal-input" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" style="border-color: rgba(255, 50, 50, 0.3);">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('admin')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="adminLogin()" style="background: linear-gradient(135deg, #dc2626, #ef4444);">–í–æ–π—Ç–∏</button>
        </div>
        <div class="modal-message" id="adminMessage"></div>
    </div>
</div>

<script>
let userData = null;
let mouseX = 0, mouseY = 0;
let adminAuthorized = localStorage.getItem('adminAuth') === 'true';

// ========== –°–û–õ–ù–ï–ß–ù–´–ï –õ–£–ß–ò ==========
function createRays() {
    const container = document.getElementById('raysContainer');
    const rayCount = 40;
    
    for (let i = 0; i < rayCount; i++) {
        const ray = document.createElement('div');
        ray.className = 'ray';
        const angle = (i / rayCount) * 180 - 90; // –æ—Ç -90 –¥–æ 90 –≥—Ä–∞–¥—É—Å–æ–≤
        ray.style.transform = `rotate(${angle}deg)`;
        ray.style.opacity = Math.random() * 0.3 + 0.1;
        ray.style.width = (Math.random() * 3 + 1) + 'px';
        ray.dataset.baseAngle = angle;
        ray.dataset.followFactor = (i % 4 === 0) ? 3 : (i % 2 === 0) ? 1.5 : 0.5;
        container.appendChild(ray);
    }
}

document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
    
    const rays = document.querySelectorAll('.ray');
    const centerX = window.innerWidth / 2;
    const offsetX = (mouseX - centerX) / centerX * 8;
    
    rays.forEach((ray) => {
        const baseAngle = parseFloat(ray.dataset.baseAngle);
        const followFactor = parseFloat(ray.dataset.followFactor);
        ray.style.transform = `rotate(${baseAngle + offsetX * followFactor}deg)`;
    });
});

createRays();
</script>

<script>
// ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
async function loadUserData() {
    try {
        const response = await fetch('/api/check-auth');
        const data = await response.json();
        
        if (!data.authenticated) {
            window.location.href = '/';
            return;
        }
        
        userData = data;
        
        document.getElementById('usernameDisplay').textContent = data.username;
        document.getElementById('navUsername').textContent = data.username;
        document.getElementById('uidDisplay').textContent = data.uid;
        
        document.getElementById('infoUsername').textContent = data.username;
        document.getElementById('infoEmail').textContent = data.email || '–ù–µ —É–∫–∞–∑–∞–Ω';
        document.getElementById('infoHwid').textContent = data.hwid ? data.hwid.substring(0, 20) + '...' : '–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω';
        
        if (data.subscription_active) {
            const expires = new Date(data.subscription_expires);
            const dateStr = expires.toLocaleDateString('ru-RU') + ' ' + expires.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            document.getElementById('subscriptionDisplay').textContent = dateStr;
            document.getElementById('infoSubscription').textContent = dateStr;
            
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.classList.add('active');
            downloadBtn.textContent = 'üì• Download Loader';
        } else {
            document.getElementById('subscriptionDisplay').textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
            document.getElementById('infoSubscription').textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
        }
        
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('cabinetContent').style.display = 'flex';
        
        initBalls();
        animate();
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        window.location.href = '/';
    }
}

// ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ==========
function openModal(type) {
    document.getElementById(type + 'Modal').classList.add('active');
}

function closeModal(type) {
    document.getElementById(type + 'Modal').classList.remove('active');
}

async function activateKey() {
    const keyCode = document.getElementById('keyInput').value.trim();
    const messageDiv = document.getElementById('keyMessage');
    
    if (!keyCode) { showMessage(messageDiv, '–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á', false); return; }
    
    try {
        const response = await fetch('/api/activate-key', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key_code: keyCode })
        });
        const data = await response.json();
        showMessage(messageDiv, data.message, data.success);
        
        if (data.success) {
            document.getElementById('keyInput').value = '';
            setTimeout(() => { closeModal('key'); loadUserData(); }, 1500);
        }
    } catch (error) { showMessage(messageDiv, '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', false); }
}

async function changePassword() {
    const oldPass = document.getElementById('oldPassword').value;
    const newPass = document.getElementById('newPassword').value;
    const messageDiv = document.getElementById('passwordMessage');
    
    if (!oldPass || !newPass) { showMessage(messageDiv, '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', false); return; }
    
    try {
        const response = await fetch('/api/change-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ old_password: oldPass, new_password: newPass })
        });
        const data = await response.json();
        showMessage(messageDiv, data.message, data.success);
        if (data.success) {
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
            setTimeout(() => closeModal('password'), 1500);
        }
    } catch (error) { showMessage(messageDiv, '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', false); }
}

function saveRam() {
    const ram = document.getElementById('ramInput').value;
    localStorage.setItem('vodka_ram', ram);
    closeModal('ram');
    alert('RAM —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ' + ram + ' GB');
}

function showMessage(div, text, success) {
    div.style.display = 'block';
    div.style.background = success ? 'rgba(50, 255, 50, 0.2)' : 'rgba(255, 50, 50, 0.2)';
    div.style.color = success ? '#55ff55' : '#ff5555';
    div.textContent = text;
}

document.getElementById('downloadBtn').addEventListener('click', () => {
    if (userData && userData.subscription_active) {
        window.open('https://www.dropbox.com/scl/fi/2zbuk1s0opsmjl21zrsd3/VodkaClient.exe?rlkey=vt6dzy7evnbxr8rosnidyyaio&st=caeou3b8&dl=1', '_blank');
    } else { alert('–ù—É–∂–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞'); }
});

document.getElementById('logoutBtn').addEventListener('click', async () => {
    await fetch('/api/logout', { method: 'POST' });
    window.location.href = '/';
});

// ========== –®–ê–†–ò–ö–ò –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï ==========
const canvas = document.getElementById('ballsCanvas');
const ctx = canvas.getContext('2d');

let balls = [];
let ballMouse = { x: 0, y: 0, vx: 0, vy: 0, prevX: 0, prevY: 0 };
let frameCount = 0;

const colors = ['#a855f7', '#7c3aed', '#8b5cf6', '#c084fc', '#9333ea', '#d946ef'];

function initBalls() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    balls = [];
    for (let i = 0; i < 10; i++) { // –ú–∏–Ω–∏–º—É–º —à–∞—Ä–∏–∫–æ–≤ –¥–ª—è FPS
        const radius = Math.random() * 6 + 4; // –ú–µ–Ω—å—à–µ: 4-10
        balls.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height * 0.6,
            vx: (Math.random() - 0.5) * 0.15,
            vy: Math.random() * 0.15,
            radius: radius,
            color: colors[Math.floor(Math.random() * colors.length)],
            mass: radius * 0.1,
            alpha: Math.random() * 0.4 + 0.4
        });
    }
}

function drawBall(ball) {
    ctx.globalAlpha = ball.alpha;
    
    // –ü—Ä–æ—Å—Ç–æ–π –∫—Ä—É–≥ –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fillStyle = ball.color;
    ctx.fill();
    
    // –ú–∞–ª–µ–Ω—å–∫–∏–π –±–ª–∏–∫
    ctx.beginPath();
    ctx.arc(ball.x - ball.radius * 0.3, ball.y - ball.radius * 0.3, ball.radius * 0.2, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
    ctx.fill();
    
    ctx.globalAlpha = 1;
}

function updateBall(ball) {
    ball.vy += 0.012;
    ball.vx *= 0.995;
    ball.vy *= 0.995;
    
    ball.x += ball.vx;
    ball.y += ball.vy;
    
    const dx = ball.x - ballMouse.x;
    const dy = ball.y - ballMouse.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    
    if (dist < 40 + ball.radius) {
        const angle = Math.atan2(dy, dx);
        const force = (40 + ball.radius - dist) * 0.04 / ball.mass;
        ball.vx += Math.cos(angle) * force + ballMouse.vx * 0.08;
        ball.vy += Math.sin(angle) * force + ballMouse.vy * 0.08;
    }
    
    if (ball.x - ball.radius < 0) { ball.x = ball.radius; ball.vx *= -0.5; }
    if (ball.x + ball.radius > canvas.width) { ball.x = canvas.width - ball.radius; ball.vx *= -0.5; }
    if (ball.y - ball.radius < 0) { ball.y = ball.radius; ball.vy *= -0.5; }
    if (ball.y + ball.radius > canvas.height) { ball.y = canvas.height - ball.radius; ball.vy *= -0.5; }
}

function checkCollisions() {
    for (let i = 0; i < balls.length; i++) {
        for (let j = i + 1; j < balls.length; j++) {
            const b1 = balls[i], b2 = balls[j];
            const dx = b2.x - b1.x, dy = b2.y - b1.y;
            const distSq = dx * dx + dy * dy;
            const minDist = b1.radius + b2.radius;
            
            if (distSq < minDist * minDist) {
                const dist = Math.sqrt(distSq);
                const overlap = (minDist - dist) / 2;
                const angle = Math.atan2(dy, dx);
                
                b1.x -= Math.cos(angle) * overlap;
                b1.y -= Math.sin(angle) * overlap;
                b2.x += Math.cos(angle) * overlap;
                b2.y += Math.sin(angle) * overlap;
                
                const nx = dx / dist, ny = dy / dist;
                const dvn = (b1.vx - b2.vx) * nx + (b1.vy - b2.vy) * ny;
                
                if (dvn > 0) {
                    const factor = dvn / (b1.mass + b2.mass) * 0.4;
                    b1.vx -= factor * b2.mass * nx;
                    b1.vy -= factor * b2.mass * ny;
                    b2.vx += factor * b1.mass * nx;
                    b2.vy += factor * b1.mass * ny;
                }
            }
        }
    }
}

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    ballMouse.vx = (ballMouse.x - ballMouse.prevX) * 0.5;
    ballMouse.vy = (ballMouse.y - ballMouse.prevY) * 0.5;
    ballMouse.prevX = ballMouse.x;
    ballMouse.prevY = ballMouse.y;
    
    balls.forEach(updateBall);
    checkCollisions();
    balls.forEach(drawBall);
    
    requestAnimationFrame(animate);
}

canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    ballMouse.x = e.clientX - rect.left;
    ballMouse.y = e.clientY - rect.top;
});

window.addEventListener('resize', initBalls);

// ========== –ê–î–ú–ò–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (Alt+N) ==========
document.addEventListener('keydown', (e) => {
    if (e.altKey && (e.key === 'n' || e.key === 'N' || e.key === '—Ç' || e.key === '–¢')) {
        e.preventDefault();
        e.stopPropagation();
        
        if (adminAuthorized) {
            window.location.href = '/admin.html';
        } else {
            openModal('admin');
            setTimeout(() => document.getElementById('adminPassword').focus(), 100);
        }
    }
});

function adminLogin() {
    const password = document.getElementById('adminPassword').value;
    const messageDiv = document.getElementById('adminMessage');
    const ADMIN_PASSWORD = 'vodka2024admin';
    
    if (password === ADMIN_PASSWORD) {
        adminAuthorized = true;
        localStorage.setItem('adminAuth', 'true');
        showMessage(messageDiv, '–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω!', true);
        setTimeout(() => { window.location.href = '/admin.html'; }, 500);
    } else {
        showMessage(messageDiv, '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', false);
        document.getElementById('adminPassword').value = '';
    }
}

document.getElementById('adminPassword').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') adminLogin();
});

// –ó–∞–ø—É—Å–∫
loadUserData();
</script>

</body>
</html>
